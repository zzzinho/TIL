# 오브젝트와 의존관계
## DAO(Data Access Object)
> DB를 사용해 데이터를 조회하거나 조작하는 기능을 전담하는 오브젝트
- 자바빈(Java Bean)
  - 자바빈은 다음 두가지 관례를 따라 만들어진 오브젝트이다.
  - 디폴트 생성자
    - 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야한다. 
    - 리플렉션을 이용해 오브젝트를 생성하기 때문
  - 프로퍼티
    - 자바빈이 노출하는 이름을 가진 속성
    - setter와 getter를 이용해 수정 또는 조회할 수 있다.
  
### Entity
```java
@Getter
@Setter
class User {
    String id;
    String name;
    String password;
}
```
```sql
create table users (
    id varchar(10) primary key,
    name varchar(20) not null,
    password varchar(10) not null
)
```
### DAO
- JDBC를 이용하는 작업의 일반적인 순서
  - DB 연결을 위한 Connection을 가져온다.
  - SQL을 담은 Statement를 만든다.
  - 만들어진 Statement를 실행한다.
  - 조회의 경우 SQL 쿼리의 실행 결과를 ResultSet으로 받아서 정보를 저장할 오브젝트에 옮겨준다.
  - 작업 중에 생성된 Connection, Statement, ResultSet 같은 리소스는 작업을 마친 후 반드시 닫아준다.
  - JDBC API가 만들어내는 예외를 직접 처리하거나, thorws를 통해 메소드 밖으로 던진다.
    - 예외는 모두 메소드 밖으로 던지는 편이 간단하다.

```java
public class UserDao {
    public void add(User user) throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.jdbc.Driver");
        Connection c = DriverManager.getConnection(
            "jdbc:mysql://localhost/springbook", "spring", "book"
        );
        
        PreparedStatement ps = c.prepareStatement(
            "insert into users(id, name, password) values(?,?,?)"
        );

        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());

        ps.executeUpate();

        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.jdbc.Driver");
        Connection c = DriverManager.getConnection(
            "jdbc:msql://localhost/springbook", "spring", "book"
        );

        PreparedStatement ps = c.prepareStatement(
            "select * from users where id = ?"
        );
        ps.setString(1, id);

        ResultSet rs = ps.executeQuery();
        rs.next();
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getName("name"));
        user.setPassword(rs.getPassword("password"));

        rs.close();
        ps.close();
        c.close();

        return user;
    }
}
```
- DAO는 잘 작동하겠지만 잘 작성된 코드는 아니다.

### Test
```java
public static void main(String[] args) throws ClassNotFoundException, SQLException {
    UserDao dao = new UserDao();

    User user = new User();
    user.setId("zzzinho");
    user.setName("진호");
    user.setPassowrd("not_married");

    dao.add(user);

    System.out.println(user.getId() + " 등록 성공");

    User user2 = dao.get(user.getId());
    System.out.println(user2.getName());
    System.out.println(user2.getPassword());

    System.out.println(user2.getId() + " 조회 성공");
}
```

## DAO의 분리
### 관심사의 분리
> 관심이 같은 것끼리  하나의 객체 안으로 또는 친한 객체로 모이게하고 관심이 다른 것은 가능한 따로 떨어져서 서로 영향을 주지 않도록 분리하는것

### 커넥션 만들기의 추출
#### UserDao의 관심사항
- add() 메소드에서 3가지 관심사항을 추출할 수 있다.
  - DB와 연결을 위한 커넥션을 어떻게 가져올까 
  - 사용자 등록을 위해 DB에 보낼 SQL 문장을 담을 Statement 관리
  - 작업이 끝나면 사용한 리소스를 닫아줘서 공유 리소스를 시스템에 돌려준다.
#### 중복 코드의 메소드 추출
```java
private Connection getConnection() throws ClassNotFoundException, SQLException {
    Class.forName("com.mysql.jdbc.Driver");
    Connection c = DriverManager.getConnection(
        "jdbc:mysql://localhost/springbook", "spring", "book");
    );
    return c;
}
```
- Connection을 형성하는 부분을 추출해서 중복을 줄인다.

#### 변경사항 검증: 리팩토링과 테스트
